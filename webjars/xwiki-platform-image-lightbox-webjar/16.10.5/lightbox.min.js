'use strict';define("xwiki-lightbox-messages",{prefix:"core.viewers.attachments.",keys:["date","author"]});define("xwiki-lightbox-config",["jquery"],function(a){var p=JSON.parse(a("#lightbox-config").text());a("body").append(a(p.HTMLTemplate))});
define("xwiki-lightbox-description",["jquery","xwiki-l10n!xwiki-lightbox-messages","moment","moment-jdateformatparser","moment-timezone"],function(a,p,u){var l={},q=function(){var e=0<a(".blueimp-gallery-controls").length,g=a("#blueimp-gallery").find(".caption, .title, .publisher, .date").filter((k,m)=>!a(m).is(":empty"));e&&0<g.length?a(".lightboxDescription").css("display","flex"):a(".lightboxDescription").css("display","none")},n=function(e,g){if(e){var k=e.alt==decodeURIComponent(e.href)?"":e.alt;
a(".lightboxDescription .caption").html(e.caption||k||e.title)}a(".lightboxDescription .caption").is(":empty")&&(g&&g.name?a(".lightboxDescription .caption").html(g.name):e&&e.fileName&&a(".lightboxDescription .caption").html(e.fileName))},v=function(e,g){var k=a.Deferred();if(void 0!=l[e])k.resolve(l[e]);else{var m=XWiki.Model.resolve("XWiki.Lightbox.AttachmentMetaDataService",XWiki.EntityType.DOCUMENT);m=(new XWiki.Document(m)).getURL("get","outputSyntax=plain");a.getJSON(m,{imageURL:e}).done(function(r){l[e]=
r;k.resolve(r)}).fail(function(){g?(l[e]={name:g},k.resolve({name:g})):k.reject()})}return k.promise()};a(document).on("click","#blueimp-gallery .slides",q);return{invalidateCachedAttachments:function(){l={}},addSlideDescription:function(e){a(".lightboxDescription .caption").empty();a(".lightboxDescription .title").empty();a(".lightboxDescription .publisher").empty();a(".lightboxDescription .date").empty();q();v(e.href,e.fileName).done(function(g){n(e,g);if(g&&(e.caption&&g.name&&a(".lightboxDescription .title").text(g.name),
g.authorName&&a(".lightboxDescription .publisher").text(p.get("author",g.authorName)),g.date)){var k=u().toMomentFormatString(a(".lightboxDescription .date").data("dateFormat")),m=a(".lightboxDescription .date").data("userTimeZone");a(".lightboxDescription .date").text(p.get("date",u(g.date).tz(m).format(k)))}q()}).fail(function(){n(e,void 0);q()})}}});
define("xwiki-lightbox","jquery xwiki-lightbox-description blueimp-gallery xwiki-lightbox-config blueimp-gallery-fullscreen blueimp-gallery-indicator".split(" "),function(a,p,u){var l,q,n,v=function(){var f=setTimeout(function(){a("#imagePopoverContainer").popover("hide")},3E3);a("#imagePopoverContainer .popover").on("mouseenter",function(){clearTimeout(f)});a("#imagePopoverContainer .popover").on("mouseleave",function(){f=setTimeout(function(){a("#imagePopoverContainer").popover("hide")},500)});
return f},e=function(){var f,c,b=a("#imagePopoverContainer");b.popover({content:function(){return a("#imageToolbarTemplate").html()},html:!0,sanitize:!1,container:"#imagePopoverContainer",placement:"bottom",trigger:"manual"}).on("show.bs.popover",function(){var d=a("#imagePopoverContainer").data("target");a(".popover").hide();a("#lightboxDownload").attr("href",d.src);a("#lightboxDownload").attr("download",g(d.src));a(".openLightbox").data("index",[...n].indexOf(d))}).on("inserted.bs.popover",function(){a(this).css("top",
a(this).position().top+2+"px");var d=a("#imagePopoverContainer").data("target");a(".popover .imageDownload").attr("href",d.src);a(".popover .imageDownload").attr("download",g(d.src));if(d=k(d))a(".popover .permalink").attr("href","#"+d),a(".popover .permalink").removeClass("hidden"),a(".popover .copyImageId").attr("data-imageId",d),a(".popover .copyImageId").parent().removeClass("hidden")});let t=a(JSON.parse(a("#lightbox-config").text()).togglerTemplate);n.each(function(){let d=t.clone();d.get(0).addEventListener("focus",
h=>{d.get(0).classList.remove("sr-only")});d.get(0).addEventListener("focusout",h=>{d.get(0).classList.add("sr-only")});d.get(0).addEventListener("click",h=>{clearTimeout(c);b.data("target",this);let w=h.pageX;h=h.pageY;0===w&&0===h&&(h=d.offset(),w=h.left,h=h.top);b.css({left:w,top:h});b.popover("show");a(".openLightbox").focus();b.append(a("<div id='popoverKeyboardEscaper' class='sr-only' tabindex='0'>"));let x=function(y){b.children().get(0).contains(y.relatedTarget)||(b.get(0).removeEventListener("focusout",
x),d.focus(),b.popover("hide"),a("#popoverKeyboardEscaper").remove())};b.get(0).addEventListener("focusout",x)});d.insertAfter(this)});n.on("mouseenter",function(d){clearTimeout(f);b.data("target",d.target)}).on("mousemove",function(d){clearTimeout(c);c=setTimeout(function(){b.css({top:d.pageY,left:d.pageX});b.popover("show")},500)}).on("mouseleave",function(){clearTimeout(c);f=v()})},g=function(f){f=decodeURI((new URL(f)).pathname.split("/").pop());if(/\.[a-zA-Z]*/g.test(f))return f},k=function(f){var c=
a(f).closest("figure").find("figcaption").find("[id]")[0];return c?a(c).attr("id"):a(f).attr("id")},m=function(){var f=[];n.each(function(){var c=new URL(this.src);var b=new URLSearchParams(c.search);b.delete("width");b.delete("height");c.search=b.toString();c=c.toString();b=a(this);var t=b.closest("figure");0<b.closest("figure").length?(b=t.find("figcaption").html(),b=a("<div></div>").html(b)):b=void 0;t=f.push;var d=new URL(c),h=new URLSearchParams(d.search);h.append("width","150");h.append("height",
"150");d.search=h.toString();t.call(f,{href:c,thumbnail:d.toString(),caption:b,fileName:g(c),alt:a(this).attr("alt"),title:a(this).attr("title"),id:k(this)})});return f},r=function(){n=a("#xwikicontent img").filter((f,c)=>0!=a(c.closest("[data-xwiki-lightbox]")).data("xwikiLightbox"));q=m();p.invalidateCachedAttachments();e()};a(document).on("click",".openLightbox",function(f){f.preventDefault();f={container:"#blueimp-gallery",index:parseInt(a(".openLightbox").data("index")),closeClass:"escape",playPauseClass:"autoPlay",
onslide:function(c,b){c=this.list[c];p.addSlideDescription(c);a(b).find("img").attr("alt",c.alt);a("#lightboxDownload").attr("href",c.href);a("#lightboxDownload").attr("download",c.fileName);b=a("#blueimp-gallery .copyImageId");c.id?(b.parent().removeClass("hidden"),b.attr("data-imageId",c.id)):(b.parent().addClass("hidden"),b.removeAttr("data-imageId"))}};l=u(q,f)});a(document).on("click","#lightboxFullscreen",function(){a("#lightboxFullscreen").data("open")?(l.exitFullScreen(),a("#lightboxFullscreen").data("open",
!1)):(l.requestFullScreen(a("#blueimp-gallery")[0]),a("#lightboxFullscreen").data("open",!0))});a(function(){r()});a(document).on("click",".copyImageId",function(f){f.preventDefault();var c=this;navigator.clipboard.writeText(a(c).attr("data-imageId")).then(function(){a(c).tooltip("show");setTimeout(function(){a(c).tooltip("hide")},2E3)})});a(document).on("xwiki:dom:updated",function(){a("#blueimp-gallery").data("isViewMode")&&r()});a(document).on("xwiki:actions:edit",function(){a("#blueimp-gallery").data("isViewMode",
!1);a(".popover").popover("destroy")});a(document).on("xwiki:actions:view",function(){a("#blueimp-gallery").data("isViewMode",!0)})});
//# sourceMappingURL=lightbox.min.js.map
