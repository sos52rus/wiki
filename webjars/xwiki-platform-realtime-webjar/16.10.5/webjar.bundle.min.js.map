{
"version":3,
"file":"webjar.bundle.min.js",
"lineCount":51,
"mappings":"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",
"sources":["config.js","crypto.js","document.js","interface.js","loader.js","messages.js","saver.js","toolbar.js","typingTests.js","userData.js"],
"sourcesContent":["/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\ndefine('xwiki-realtime-config', ['jquery'], function($) {\n  try {\n    return JSON.parse($('#realtime-config').text());\n  } catch (e) {\n    console.error(e);\n    return {};\n  }\n});\n","/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\ndefine('xwiki-realtime-crypto', {\n  encrypt: function(x) {\n    return x;\n  },\n  decrypt: function(x) {\n    return x;\n  },\n  parseKey: function() {\n    return {cryptKey: ''};\n  }\n});\n","/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\ndefine('xwiki-realtime-document', [\n  'jquery',\n  'xwiki-meta',\n  'xwiki-realtime-config'\n], function($, meta, realtimeConfig) {\n  'use strict';\n\n  const channelListAPI = {\n    getByPath: function(path) {\n      return this.filter(channel => JSON.stringify(channel.path) === JSON.stringify(path))[0];\n    },\n    getByPathPrefix: function(pathPrefix) {\n      return this.filter(channel => channel.path.length >= pathPrefix.length &&\n        JSON.stringify(channel.path.slice(0, pathPrefix.length)) === JSON.stringify(pathPrefix));\n    }\n  };\n\n  class XWikiDocument {\n    constructor() {\n      // Initialize with document fields coming from the real-time configuration.\n      $.extend(this, realtimeConfig.document);\n      this.update();\n    }\n\n    reload() {\n      return $.getJSON(meta.restURL, {\n        // Make sure the response is not retrieved from cache (IE11 doesn't obey the caching HTTP headers).\n        timestamp: new Date().getTime()\n      }).then(updatedDocument => {\n        // Reload succeeded.\n        // We were able to load the document so it's not new.\n        this.isNew = false;\n        return $.extend(this, updatedDocument, {\n          // We need the real locale.\n          language: updatedDocument.language || updatedDocument.translations['default']\n        });\n      }, jqXHR => {\n        if (jqXHR.status === 404) {\n          // The document doesn't exist anymore. Maybe it was deleted?\n          return $.extend(this, {\n            version: '1.1',\n            modified: 0,\n            content: '',\n            isNew: true\n          });\n        } else {\n          // Reload failed. Continue using the current data.\n          return this;\n        }\n      }).then(this.update.bind(this));\n    }\n\n    update(data) {\n      data = data || {\n        documentReference: meta.documentReference,\n        // We need the real locale.\n        language: meta.locale || realtimeConfig.document.language,\n        version: meta.version,\n        // The timestamp of the last modification is needed to be able to properly merge on save.\n        modified: meta.modified || realtimeConfig.document.modified,\n        isNew: meta.isNew\n      };\n      $.extend(this, data);\n      if (this.documentReference === meta.documentReference && this.version !== meta.version) {\n        // Update the meta and the hidden fields used by the edit form in order to ensure proper merge on save.\n        meta.setVersion(this.version);\n        $('#editingVersionDate').val(this.modified);\n        $('#isNew').val(this.isNew);\n      }\n      return this;\n    }\n\n    save(data) {\n      return $.post(window.docsaveurl, $.param($.extend({\n        /* jshint camelcase:false */\n        form_token: meta.form_token,\n        xredirect: '',\n        language: this.language,\n        xaction: ['save', 'saveandcontinue', 'preview', 'cancel'],\n        action_saveandcontinue: 'Save',\n        xeditaction: 'edit',\n        previousVersion: this.version,\n        isNew: this.isNew,\n        editingVersionDate: this.modified,\n        minorEdit: 1,\n        ajax: true\n      }, data), true)).then(this.reload.bind(this));\n    }\n\n    getChannels(params) {\n      const url = new XWiki.Document(this.documentReference).getRestURL('channels');\n      params = $.extend({\n        // Make sure the response is not retrieved from cache (IE11 doesn't obey the caching HTTP headers).\n        timestamp: new Date().getTime()\n      }, params);\n      return $.getJSON(url, $.param(params, true)).then(function(data) {\n        if (!Array.isArray(data)) {\n          console.error('Failed to retrieve the list of document channels.');\n          return Promise.reject(data);\n        } else {\n          return $.extend(data, channelListAPI);\n        }\n      });\n    }\n  }\n\n  // Initialize the document fields based on the meta information available on page load.\n  const xwikiDocument = new XWikiDocument();\n\n  // Update the document fields before and after the document is edited inplace (without reloading the web page).\n  $(document).on('xwiki:actions:edit xwiki:actions:view', function(event, data) {\n    xwikiDocument.update();\n  });\n\n  return xwikiDocument;\n});\n","/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\n// This file defines functions which are used by the real-time editors (Wiki / WYSIWYG) and address components of the\n// user interface.\ndefine('xwiki-realtime-interface', ['jquery', 'xwiki-l10n!xwiki-realtime-messages'], function($, Messages) {\n  'use strict';\n\n  function uid() {\n    return 'realtime-uid-' + String(Math.random()).substring(2);\n  }\n\n  let allowed = false;\n  function realtimeAllowed(bool) {\n    if (arguments.length) {\n      // Change the value.\n      allowed = !!bool;\n      // The real-time edit doesn't support the standard auto-save feature (it provides instead its own auto-save).\n      $('#autosaveControl').toggle(!allowed);\n    }\n    return allowed;\n  }\n\n  function createAllowRealtimeCheckbox(checked) {\n    let allowRealtimeCheckbox = getAllowRealtimeCheckbox();\n    // Don't duplicate the checkbox if it already exists.\n    if (!allowRealtimeCheckbox.length) {\n      const wrapper = $(\n        '<label class=\"realtime-allow-label text-nowrap\">' +\n          '<input type=\"checkbox\" class=\"realtime-allow\"/>' +\n        '</label>'\n      ).appendTo('.buttons');\n      allowRealtimeCheckbox = wrapper.append(document.createTextNode(Messages.allowRealtime)).find('input');\n    }\n    return allowRealtimeCheckbox.prop('checked', !!checked);\n  }\n\n  function getAllowRealtimeCheckbox() {\n    return $('input.realtime-allow[type=\"checkbox\"]');\n  }\n\n  function createMergeMessageElement(container) {\n    const $merges = $('<div class=\"realtime-merge\"></div>').attr('id', uid()).prependTo(container);\n\n    let timeout;\n\n    // Drop a method into the lastSaved object which handles messages.\n    return function (messageKey, args) {\n      // Keep multiple message sequences from fighting over resources.\n      clearTimeout(timeout);\n\n      const formattedMessage = Messages.get(messageKey, ...args);\n\n      console.debug(formattedMessage);\n\n      // Set the message, handle all types.\n      $merges.text(formattedMessage);\n\n      // Clear the message box in 10 seconds (1.5s message fadeout time).\n      timeout = setTimeout(function() {\n        $merges.fadeOut(1500, function() {\n          $merges.empty().show();\n        });\n      }, 10000);\n    };\n  }\n\n  return {uid, realtimeAllowed, createAllowRealtimeCheckbox, getAllowRealtimeCheckbox, createMergeMessageElement};\n});\n","/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\ndefine('xwiki-realtime-loader', [\n  'jquery',\n  'xwiki-meta',\n  'xwiki-realtime-config',\n  'xwiki-realtime-document',\n  'xwiki-l10n!xwiki-realtime-messages',\n  'xwiki-events-bridge'\n], function(\n  /* jshint maxparams:false */\n  $, xm, realtimeConfig, doc, Messages\n) {\n  'use strict';\n\n  if (!realtimeConfig.webSocketURL) {\n    console.error('The WebSocket URL is missing. Aborting attempt to configure a realtime session.');\n    return;\n  }\n\n  let module = {\n    isForced: window.location.href.indexOf('force=1') >= 0,\n    connectionStatusNotification: new XWiki.widgets.Notification('', '', {inactive: true}),\n  },\n\n  // FIXME: The real-time JavaScript code is not loaded anymore on the \"lock\" page so this code is not really used. We\n  // need to decide if we want to re-add the real-time JavaScript code on the lock page and how.\n  getDocLock = module.getDocLock = function() {\n    const lockedBy = document.querySelectorAll('p.xwikimessage .wikilink a');\n    const force = document.querySelectorAll('a[href*=\"force=1\"][href*=\"/edit/\"]');\n    return (lockedBy.length && force.length) ? force[0] : null;\n  },\n\n  getRTEditorURL = module.getEditorURL = function(href, info) {\n    const currentURL = new URL(href);\n    const baseURL = new URL(\"?\", currentURL).toString();\n    const params = new URLSearchParams(currentURL.search);\n    ['editor', 'section', 'force', 'realtime'].forEach(param => params.delete(param));\n    const hash = info.href.includes('#') ? '' : currentURL.hash;\n    return baseURL + params.toString() + info.href + hash;\n  },\n\n  allRt = {\n    state: false\n  },\n\n  // Returns a promise that resolves with the list of editor channels available for the specified field of the current\n  // document in the current language.\n  checkSocket = function(field) {\n    const path = `${doc.language}/${field}/`;\n    return doc.getChannels({path}).then(function(channels) {\n      return channels.filter(channel => channel?.path?.length > 2 && channel?.userCount > 0)\n        .map(channel => channel.path.slice(2).join('/'));\n    });\n  },\n\n  lock = getDocLock();\n\n  class RealtimeContext {\n    constructor(info) {\n      this.info = info;\n      this.network = allRt.network;\n\n      // Realtime enabled by default.\n      this.realtimeEnabled = window.location.href.indexOf('realtime=false') < 0;\n      this.webSocketURL = realtimeConfig.webSocketURL;\n\n      const userReference = xm.userReference ? XWiki.Model.serialize(xm.userReference) : 'xwiki:XWiki.XWikiGuest';\n      this.user = {\n        // userId === <userReference>-encoded(<userName>)%2d<randomNumber>\n        name: userReference + '-' + encodeURIComponent(realtimeConfig.user.name + '-').replace(/-/g, '%2d') +\n          String(Math.random()).substring(2),\n        avatarURL: realtimeConfig.user.avatarURL,\n        advanced: realtimeConfig.user.advanced\n      };\n\n      RealtimeContext.instances = RealtimeContext.instances || {};\n      RealtimeContext.instances[info.field] = this;\n    }\n\n    async updateChannels() {\n      const channels = await doc.getChannels({\n        path: [\n          doc.language + '/events/1.0',\n          doc.language + '/events/userdata',\n          `${doc.language}/${this.info.field}/${this.info.type}`,\n          // Check also if the field is edited in real-time with other editors at the same time.\n          `${doc.language}/${this.info.field}/`,\n        ],\n        create: true\n      });\n      this.channels = this._parseChannels(channels);\n      return this.channels;\n    }\n\n    _parseChannels(channels) {\n      let keys = {};\n      const eventsChannel = channels.getByPath([doc.language, 'events', '1.0']);\n      const userDataChannel = channels.getByPath([doc.language, 'events', 'userdata']);\n      const editorChannel = channels.getByPath([doc.language, this.info.field, this.info.type]);\n      if (!eventsChannel || !userDataChannel || !editorChannel) {\n        console.error('Missing document channels.');\n      } else {\n        keys = $.extend(keys, {\n          [this.info.type]: editorChannel.key,\n          [this.info.type + '_users']: editorChannel.userCount,\n          events: eventsChannel.key,\n          userdata: userDataChannel.key,\n          active: {}\n        });\n        // Collect the other active real-time editing session (for the specified document field) that are using a\n        // different editor (e.g. the WYSIWYG editor).\n        channels.getByPathPrefix([doc.language, this.info.field]).forEach(channel => {\n          if (channel.userCount > 0 && JSON.stringify(channel.path) !== JSON.stringify(editorChannel.path)) {\n            keys.active[channel.path.slice(2).join('/')] = channel;\n          }\n        });\n      }\n      return keys;\n    }\n\n    /**\n     * Notify the other users that we're editing in realtime or not.\n     * \n     * @param {boolean} realtimeEnabled whether the user is editing in realtime or not\n     */\n    setRealtimeEnabled(realtimeEnabled) {\n      this.realtimeEnabled = realtimeEnabled;\n      // Notify the others only if we're still editing (only if this context is still associated with the edited field).\n      if (RealtimeContext.instances[this.info.field] === this) {\n        allRt.wChan?.bcast(JSON.stringify({\n          cmd: 'join',\n          field: this.info.field,\n          realtime: realtimeEnabled\n        }));\n        updateWarning();\n      }\n    }\n\n    destroy() {\n      if (RealtimeContext.instances[this.info.field] === this) {\n        delete RealtimeContext.instances[this.info.field];\n        // Notify the others that we stopped editing this field.\n        allRt.wChan?.bcast(JSON.stringify({\n          cmd: 'leave',\n          field: this.info.field\n        }));\n        updateWarning();\n      }\n    }\n\n    displayReloadModal() {\n      // The channel keys have changed while we were offline. We may not have the latest version of the document. The\n      // safest solution is to reload.\n      const content = createModalContent(Messages['reloadDialog.prompt'], Messages['reloadDialog.exit']);\n      const buttonReload = $('<button class=\"btn btn-default\"></button>').text(Messages['reloadDialog.reload']);\n      buttonReload.on('click', window.location.reload.bind(window.location, true)).insertAfter(content.find('button'));\n      displayCustomModal(content[0]);\n    }\n\n    displayDisableModal(callback) {\n      const content = createModalContent(Messages['disableDialog.prompt'], Messages['disableDialog.ok']);\n      const buttonOK = content.find('button').on('click', callback.bind(null, true));\n      $('<button class=\"btn btn-default\"></button>').text(Messages['disableDialog.exit']).insertBefore(buttonOK)\n        .on('click', callback.bind(null, false));\n      displayCustomModal(content[0]);\n    }\n\n    static getEditedFields() {\n      return Object.keys(RealtimeContext.instances);\n    }\n\n    static getOfflineEditedFields(fields) {\n      fields = fields || RealtimeContext.getEditedFields();\n      return fields.filter(field => RealtimeContext.isOfflineEditedField(field));\n    }\n\n    static isOfflineEditedField(field) {\n      return RealtimeContext.instances[field] && !RealtimeContext.instances[field].realtimeEnabled;\n    }\n\n    static getRealtimeEditedFields(fields) {\n      fields = fields || RealtimeContext.getEditedFields();\n      return fields.filter(field => RealtimeContext.instances[field]?.realtimeEnabled);\n    }\n  }\n\n  module.checkSessions = function(info) {\n    if (lock) {\n      // Found an edit lock link.\n      checkSocket(info.field).then(types => {\n        // Determine if it's a realtime session.\n        if (types.length) {\n          console.debug('Found an active realtime session.');\n          displayModal(null, types, null, info);\n        } else {\n          console.debug(\"Couldn't find an active realtime session.\");\n          module.whenReady(function(rt) {\n            if (rt) {\n              displayModal(null, null, null, info);\n            }\n          });\n        }\n      });\n    } else {\n      // Do nothing.\n    }\n  };\n\n  let displayModal = module.displayModal = function(createType, existingTypes, callback, info) {\n    if (XWiki.widgets.RealtimeCreateModal) {\n      return;\n    }\n    existingTypes = existingTypes || [];\n    XWiki.widgets.RealtimeCreateModal = Class.create(XWiki.widgets.ModalPopup, {\n      initialize: function($super) {\n        $super(\n          this.createContent(),\n          {\n            'show': {method: this.showDialog, keys: []},\n            'close': {method: this.closeDialog, keys: ['Esc']}\n          },\n          {\n            displayCloseButton: true,\n            verticalPosition: 'center',\n            // FIXME: Use color theme or remove this line.\n            backgroundColor: '#FFF',\n            removeOnClose: true\n          }\n        );\n        this.showDialog();\n        this.setClass('realtime-create-session');\n        // FIXME: Use a better (namespaced) event name.\n        $(document).trigger('insertButton');\n      },\n\n      /**\n       * Gets the content of the modal dialog using AJAX.\n       */\n      createContent : function() {\n        let message = Messages.requestASession;\n        if (existingTypes.length > 1) {\n          message = Messages['redirectDialog.pluralPrompt'];\n        } else if (existingTypes.length === 1) {\n          message = Messages.sessionInProgress;\n        }\n\n        const content = createModalContent(message, Messages.get('redirectDialog.create', info.name));\n        const classesButtons = existingTypes.map(type => 'realtime-button-' + type).join(' ');\n        const buttonsDiv = content.find('.realtime-buttons').addClass(classesButtons).data('modal', this);\n        buttonsDiv.find('button').on('click', function() {\n          callback();\n          buttonsDiv.data('modal').closeDialog();\n        }).toggle(!!createType);\n\n        return content[0];\n      }\n    });\n    return new XWiki.widgets.RealtimeCreateModal();\n  },\n\n  displayCustomModal = function(content) {\n    XWiki.widgets.RealtimeRequestModal = Class.create(XWiki.widgets.ModalPopup, {\n      initialize : function($super) {\n        $super(\n          this.createContent(),\n          {\n            'show': {method: this.showDialog, keys: []}\n          },\n          {\n            displayCloseButton: false,\n            verticalPosition : 'center',\n            // FIXME: Use color theme or remove this line.\n            backgroundColor : '#FFF',\n            removeOnClose : true\n          }\n        );\n        this.showDialog();\n      },\n      createContent: function() {\n        $(content).find('button, input').on('click', this.closeDialog.bind(this));\n        return content;\n      }\n    });\n    return new XWiki.widgets.RealtimeRequestModal();\n  },\n\n  createModalContent = function(message, primaryActionLabel) {\n    const content = $(\n      '<div class=\"modal-popup\">' +\n        '<p></p>' +\n        '<div class=\"realtime-buttons\">' +\n          '<button class=\"btn btn-primary\"></button>' +\n        '</div>' +\n      '</div>'\n    );\n    content.find('p').text(message);\n    content.find('button').text(primaryActionLabel);\n    return content;\n  },\n\n  getRequestContent = function(info, callback) {\n    const content = createModalContent(Messages['requestDialog.prompt'],\n      Messages.get('requestDialog.create', info.name));\n\n    // Initialize auto-create\n    const autoCreate = $('<p></p>').appendTo(content);\n    let i = 30;\n    const interval = setInterval(function() {\n      i--;\n      autoCreate.text(Messages.get('requestDialog.autoCreate', i));\n      if (i <= 0) {\n        buttonCreate.click();\n        clearInterval(interval);\n        autoCreate.remove();\n      }\n    }, 1000);\n\n    const buttonCreate = content.find('button').on('click', function() {\n      clearInterval(interval);\n      try {\n        callback(true);\n      } catch (e) {\n        console.error(e);\n      }\n    });\n\n    const buttonReject = $('<button class=\"btn btn-danger\"></button>').text(Messages['requestDialog.reject']);\n    buttonReject.insertBefore(buttonCreate).on('click', function() {\n      clearInterval(interval);\n      try {\n        callback(false);\n      } catch (e) {\n        console.error(e);\n      }\n    });\n\n    return content[0];\n  },\n\n  getRejectContent = function(reason) {\n    return createModalContent(\n      reason === 'invalid' ? Messages['rejectDialog.invalid'] : Messages['rejectDialog.prompt'],\n      Messages['rejectDialog.ok']\n    )[0];\n  },\n\n  getSaveErrorContent = function() {\n    return createModalContent(Messages['requestDialog.saveError'], Messages['rejectDialog.ok'])[0];\n  };\n\n  module.displayRequestErrorModal = function() {\n    displayCustomModal(getSaveErrorContent());\n  };\n\n  const availableRt = {};\n  module.setAvailableRt = function(info) {\n    availableRt[info.type] = {\n      info,\n      cb: createRt.bind(null, info)\n    };\n  };\n\n  let createRtCalled = false,\n  createRt = function(info) {\n    if (createRtCalled) {\n      return;\n    }\n    createRtCalled = true;\n    const $saveButton = $('#mainEditArea').find('input[name=\"action_saveandcontinue\"]');\n    if ($saveButton.length) {\n      const comment = $('#commentinput');\n      const previousComment = comment.val();\n      comment.val(Messages.autoAcceptSave);\n      $saveButton.click();\n      $(document).one('xwiki:document:saved.createRt', function() {\n        $(document).off('xwiki:document:saveFailed.createRt');\n        comment.val(previousComment);\n        window.location.href = module.getEditorURL(window.location.href, info);\n      });\n      $(document).one('xwiki:document:saveFailed.createRt', function() {\n        $(document).off('xwiki:document:saved.createRt');\n        comment.val(previousComment);\n        module.displayRequestErrorModal();\n      });\n    }\n  },\n\n  getCompatibleEditor = function(type) {\n    return Object.keys(availableRt).find((availableType) => {\n      return (availableRt[availableType].info.compatible || []).indexOf(type) !== -1;\n    });\n  },\n\n  unload = false;\n  window.addEventListener('beforeunload', function() {\n    unload = true;\n    setTimeout(function() {\n      unload = false;\n    }, 5000);\n  });\n\n  let fullScreen = !!($('body').attr('data-maximized') || $('html').attr('style')),\n\n  // Trigger a resize event to resize the editable area in fullscreen mode.\n  resize = function() {\n    setTimeout(function() {\n      window.dispatchEvent(new Event('resize'));\n    });\n  },\n\n  // Place the warning box at the correct position when in fullscreen mode.\n  getBoxPosition = function() {\n    return fullScreen ? $('.buttons') : $('#hierarchy');\n  },\n\n  moveBox = function() {\n    $('.xwiki-realtime-box').insertAfter(getBoxPosition()).show();\n    $('.xwiki-realtime-box').css('margin-bottom', fullScreen ? '0' : '');\n    resize();\n  };\n\n  // Detect fullscreen mode in CKeditor.\n  // FIXME: Modify the CKEditor to fire the fullscreen events.\n  new MutationObserver(function(mutations) {\n    mutations.forEach(function (mutation) {\n      if (mutation.type === 'attributes' && mutation.attributeName === 'data-maximized') {\n        fullScreen = $('body').attr('data-maximized') === 'true';\n        moveBox();\n      }\n    });\n  }).observe($('body')[0], {\n    attributes: true\n  });\n\n  // Detect fullscreen mode in wiki editor.\n  $(document).on('xwiki:fullscreen:exited', function() {\n    fullScreen = false;\n    moveBox();\n  }).on('xwiki:fullscreen:entered', function() {\n    fullScreen = true;\n    moveBox();\n  });\n\n  // Scroll to the warning box when a message is displayed or updated.\n  let scrollToBox = function($box) {\n    moveBox();\n    $box[0].scrollIntoView();\n  },\n\n  warningVisible = false,\n  displayWarning = function(field) {\n    const $after = getBoxPosition();\n    if (unload || warningVisible || !$after.length) {\n      return;\n    }\n    warningVisible = true;\n    const $warning = $('<div></div>', {\n      'class': 'xwiki-realtime-warning xwiki-realtime-box box warningmessage'\n    }).insertAfter($after);\n    scrollToBox($warning);\n    $('<strong></strong>').text(Messages.conflictsWarning).appendTo($warning);\n    $('<br/>').appendTo($warning);\n    $('<span></span>').text(Messages.wsErrorConflicts).appendTo($warning);\n    const realtimeContext = RealtimeContext.instances[field];\n    const compatibleEditor = getCompatibleEditor(realtimeContext?.info?.type);\n    if (realtimeContext && !realtimeContext.realtimeEnabled && compatibleEditor) {\n      $('<br/>').appendTo($warning);\n      // The parameter is the edit link but we can't inject it directly because we need to escape the HTML.\n      let suggestion = Messages.get('conflictsWarningSuggestion', '__0__');\n      // The translation message shouldn't contain HTML.\n      suggestion = $('<div></div>').text(suggestion).html();\n      // The link label shouldn't contain HTML.\n      const link = $('<a></a>', {\n        href: getRTEditorURL(window.location.href, availableRt[compatibleEditor].info)\n      }).text(Messages.conflictsWarningInfoLink).prop('outerHTML');\n      // Inject the link and append the suggestion.\n      $warning.append(suggestion.replace('__0__', link));\n    } else if (realtimeContext?.realtimeEnabled) {\n      $('<br/>').appendTo($warning);\n      $('<span></span>').text(Messages.conflictsWarningInfoRt).appendTo($warning);\n    }\n  },\n\n  hideWarning = function() {\n    warningVisible = false;\n    $('.xwiki-realtime-warning').remove();\n    resize();\n  },\n\n  /**\n   * Hides the warning message and asks the other users is they are editing offline (i.e. outside the realtime session),\n   * in which case the warning message is displayed again (see onIsSomeoneOfflineMessage).\n   */\n  updateWarning = function() {\n    if (warningVisible) {\n      hideWarning();\n      // Check if someone is editing offline any of the document fields we're editing.\n      const editedFields = RealtimeContext.getEditedFields();\n      if (editedFields.length) {\n        allRt.wChan?.bcast(JSON.stringify({\n          cmd: 'isSomeoneOffline',\n          fields: editedFields\n        }));\n      }\n    }\n  },\n\n  tryParse = function(message) {\n    try {\n      return JSON.parse(message);\n    } catch (error) {\n      console.error('Cannot parse the message.', {message, error});\n    }\n  },\n\n  // Join a channel with all users on this page (realtime, offline AND lock page)\n  // 1. This channel allows users on \"lock\" page to contact the editing user and request a collaborative session, using\n  //    the `request` and `answer` commands\n  // 2. It is also used to know if someone else is editing the document concurrently (at least 2 users with 1 editing\n  //    offline). In this case, a warning message can be displayed.\n  //\n  // When someone starts editing the page, they send a `join` message with a boolean 'realtime'. When other users\n  // receive this message, they can tell if there is a risk of conflict and send a `displayWarning` command to the new\n  // user.\n  addMessageHandler = function() {\n    if (!allRt.wChan) {\n      return;\n    }\n    const channel = allRt.wChan;\n    const network = allRt.network;\n    // Whenever someone leaves the edit mode, check if the warning message is still needed.\n    channel.on('leave', updateWarning);\n    // Handle incoming messages.\n    channel.on('message', function(msg, sender) {\n      const data = tryParse(msg);\n      switch(data?.cmd) {\n        // Someone wants to create a realtime session. If the current user is editing offline, display the modal.\n        case 'request': return onRequestMessage(data, channel);\n        // Receiving an answer to a realtime session request.\n        case 'answer': return onAnswerMessage(data);\n        // Someone is joining the channel while we're editing, check if they are using realtime and if we are.\n        case 'join': return onJoinMessage(data, sender, network);\n        // Someone has stopped editing a document field. Check if the warning message is still needed.\n        case 'leave': return updateWarning();\n        // Someone wants to know if we're editing offline to know if the warning message should be displayed.\n        case 'isSomeoneOffline': return onIsSomeoneOfflineMessage(data, sender, network);\n      }\n    });\n  },\n\n  onRequestMessage = function(data, channel) {\n    if (lock || !data.field || !data.type) {\n      return;\n    }\n    const response = {\n      cmd: 'answer',\n      field: data.field,\n      type: data.type\n    };\n    // Make sure realtime is available for the requested editor.\n    if (!availableRt[data.type]) {\n      response.state = -1;\n      channel.bcast(JSON.stringify(response));\n    // Check if we're not already in realtime.\n    } else if (RealtimeContext.instances[data.field]?.realtimeEnabled) {\n      response.state = 2;\n      channel.bcast(JSON.stringify(response));\n    // Check if our current editor is realtime compatible, i.e. Object editor can't switch to WYSIWYG.\n    } else if (!getCompatibleEditor(data.type)) {\n      response.state = 0;\n      response.reason = 'invalid';\n      channel.bcast(JSON.stringify(response));\n    // We're editing offline: display the modal.\n    } else {\n      const content = getRequestContent(availableRt[data.type].info, function(state) {\n        if (state) {\n          // Accepted: save and create the realtime session.\n          availableRt[data.type].cb();\n        }\n        response.state = state ? 1 : 0;\n        channel.bcast(JSON.stringify(response));\n      });\n      setTimeout(function() {\n        $('.xdialog-modal-container').css('z-index', '99999');\n      });\n      displayCustomModal(content);\n    }\n  },\n\n  onAnswerMessage = function(data) {\n    if (!allRt.request) {\n      return;\n    }\n    const state = data.state;\n    allRt.request(state);\n    if (state === -1) {\n      module.connectionStatusNotification = module.connectionStatusNotification.replace(\n        new XWiki.widgets.Notification(Messages.connectionLost, 'error'));\n    } else if (state === 0) {\n      // Rejected\n      $('.realtime-buttons').data('modal')?.closeDialog();\n      displayCustomModal(getRejectContent(data.reason));\n    }\n  },\n\n  onJoinMessage = function(data, sender, network) {\n    const realtimeContext = RealtimeContext.instances[data.field];\n    if (lock || !realtimeContext) {\n      return;\n    // Someone has started editing the same document field as us.\n    } else if (!data.realtime || !realtimeContext.realtimeEnabled) {\n      // One of us is editing offline (outside the realtime session).\n      displayWarning(data.field);\n      network.sendto(sender, JSON.stringify({\n        cmd: 'displayWarning',\n        fields: [data.field]\n      }));\n    } else {\n      // We're both editing in realtime. Maybe we need to hide the warning message.\n      updateWarning();\n    }\n  },\n\n  onIsSomeoneOfflineMessage = function(data, sender, network) {\n    const offlineFields = RealtimeContext.getOfflineEditedFields(data.fields);\n    if (!lock && offlineFields.length) {\n      network.sendto(sender, JSON.stringify({\n        cmd: 'displayWarning',\n        fields: offlineFields\n      }));\n    }\n  },\n\n  getAllUsersChannel = function() {\n    return doc.getChannels({\n      path: doc.language + '/events/all',\n      create: true\n    }).then(channels => channels[0]);\n  },\n\n  joinAllUsers = async function() {\n    const channelInfo = await getAllUsersChannel();\n    if (!channelInfo?.key) {\n      // We can't join the all users (events) channel if we don't know its key.\n      return;\n    }\n    if (!allRt.network) {\n      allRt.network = await connectToNetfluxWebSocket();\n    }\n    await onOpen(channelInfo);\n  },\n\n  connectToNetfluxWebSocket = async function() {\n    const Netflux = await new Promise((resolve, reject) => {\n      require(['netflux-client'], resolve, reject);\n    });\n    const network = await Netflux.connect(realtimeConfig.webSocketURL);\n    // Add direct messages handler.\n    network.on('message', msg => {\n      const data = tryParse(msg);\n      if (data?.cmd === 'displayWarning') {\n        // Display the warning message only for the fields that we're still editing.\n        data.fields.filter(field => RealtimeContext.instances[field]).forEach(displayWarning);\n      }\n    });\n    // On reconnect, join the \"all\" channel again.\n    network.on('reconnect', async () => {\n      hideWarning();\n      module.connectionStatusNotification = module.connectionStatusNotification.replace(\n        new XWiki.widgets.Notification(Messages.connectingBox, 'inprogress'));\n      module.ready = joinAllUsers();\n      try {\n        await module.ready;\n        module.connectionStatusNotification.hide();\n      } catch (error) {\n        module.connectionStatusNotification = module.connectionStatusNotification.replace(\n          new XWiki.widgets.Notification(Messages.wsError, 'error'));\n        console.error(error);\n      }\n    });\n    let expectedDisconnect = false;\n    window.addEventListener('beforeunload', () => {\n      expectedDisconnect = true;\n    });\n    network.on('disconnect', () => {\n      if (!expectedDisconnect && Object.keys(RealtimeContext.instances).length) {\n        let message = Messages.connectionLost;\n        if (RealtimeContext.getRealtimeEditedFields().length) {\n          message += ' ' + Messages.connectionLostInfo;\n        }\n        module.connectionStatusNotification = module.connectionStatusNotification.replace(\n          new XWiki.widgets.Notification(message, 'warning'));\n      }\n    });\n    return network;\n  },\n\n  onOpen = async channelInfo => {\n    const channel = await allRt.network.join(channelInfo.key);\n    allRt.userList = channel.members;\n    allRt.wChan = channel;\n    allRt.channelInfo = channelInfo;\n    addMessageHandler();\n  },\n\n  maybeRejoinAllUsers = () => {\n    if (allRt.channelInfo && allRt.channelInfo.path[0] !== doc.language) {\n      // The document language has changed since we joined the all users channel (e.g. because the user has switched\n      // from editing the original document translation to editing another translation, without reloading the web page,\n      // from inplace editing). We need to join the all users channel associated with the new document language.\n      // Leave the current channel first.\n      allRt.wChan.leave('Switched to a different document translation');\n      // Then join the new channel.\n      module.ready = joinAllUsers();\n    }\n  },\n\n  beforeLaunchRealtime = function(realtimeContext) {\n    return new Promise(resolve => {\n      if (realtimeContext.realtimeEnabled) {\n        module.whenReady(function(wsAvailable) {\n          realtimeContext.realtimeEnabled = wsAvailable;\n          realtimeContext.network = allRt.network;\n          resolve(realtimeContext);\n        });\n      } else {\n        resolve(realtimeContext);\n      }\n    });\n  };\n\n  $.extend(module, {\n    requestRt: function({field, type, callback}) {\n      if (!allRt.wChan) {\n        setTimeout(function () {\n          module.requestRt({field, type, callback});\n        }, 500);\n      } else if (allRt.userList.length === 1) {\n        // No other user.\n        callback(false);\n      } else {\n        allRt.request = callback;\n        allRt.wChan.bcast(JSON.stringify({\n          cmd: 'request',\n          field,\n          type\n        }));\n      }\n    },\n\n    whenReady: async function(callback) {\n      hideWarning();\n      module.connectionStatusNotification = module.connectionStatusNotification.replace(\n        new XWiki.widgets.Notification(Messages.connectingBox, 'inprogress'));\n      try {\n        maybeRejoinAllUsers();\n        await module.ready;\n        module.connectionStatusNotification.hide();\n        callback(true);\n      } catch (error) {\n        module.connectionStatusNotification = module.connectionStatusNotification.replace(\n          new XWiki.widgets.Notification(Messages.wsError, 'error'));\n        console.error(error);\n        callback(false);\n      }\n    },\n\n    bootstrap: async function(info) {\n      this.setAvailableRt(info);\n      if (lock) {\n        // Found a lock link. Check active sessions.\n        this.checkSessions(info);\n        throw new Error('Lock detected');\n      // We currently support editing in realtime only the content field (using either the Wiki editor, the standalone\n      // WYSIWYG editor or the Inplace editor).\n      } else if (info.field === 'content' && window.XWiki.editor === info.type) {\n        // No lock and we are using the right editor. Start realtime.\n        const realtimeContext = new RealtimeContext(info);\n        const keys = await realtimeContext.updateChannels();\n        if (!keys[info.type] || !keys.events || !keys.userdata) {\n          module.connectionStatusNotification = module.connectionStatusNotification.replace(\n            new XWiki.widgets.Notification(Messages.forbidden, 'error'));\n          const error = new Error(Messages.forbidden);\n          console.error(error);\n          throw error;\n        } else if (Object.keys(keys.active).length && !keys[info.type + '_users']) {\n          // Let the user choose between joining the existing real-time session (with a different editor) or create\n          // a new real-time session with the current editor.\n          console.debug('Join the existing realtime session or create a new one.');\n          await new Promise(resolve => {\n            displayModal(info.type, Object.keys(keys.active), resolve, info);\n          });\n        }\n        return await beforeLaunchRealtime(realtimeContext);\n      } else {\n        throw new Error('Realtime editing is not supported in this context.');\n      }\n    },\n\n    ready: joinAllUsers()\n  });\n\n  return module;\n});\n\n","/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\ndefine('xwiki-realtime-messages', {\n  prefix: 'realtime.',\n  keys: [\n    'editingAlone',\n    'editingWith',\n    'disconnected',\n    'synchronizing',\n    'reconnecting',\n    'lag',\n    'allowRealtime',\n    'sessionInProgress',\n    'saved',\n    'savedRemote',\n    'redirectDialog.pluralPrompt',\n    'redirectDialog.create',\n    'requestASession',\n    'requestDialog.prompt',\n    'requestDialog.create',\n    'requestDialog.reject',\n    'requestDialog.autoCreate',\n    'requestDialog.saveError',\n    'rejectDialog.prompt',\n    'rejectDialog.invalid',\n    'rejectDialog.ok',\n    'conflictsWarning',\n    'conflictsWarningInfoRt',\n    'conflictsWarningSuggestion',\n    'conflictsWarningInfoLink',\n    'wsError',\n    'wsErrorConflicts',\n    'connectingBox',\n    'connectionLost',\n    'connectionLostInfo',\n    'forbidden',\n    'reloadDialog.prompt',\n    'reloadDialog.reload',\n    'reloadDialog.exit',\n    'disableDialog.prompt',\n    'disableDialog.ok',\n    'disableDialog.exit',\n    'autoAcceptSave',\n    'editor.getContentFailed'\n  ]\n});\n","/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\ndefine('xwiki-realtime-saver', [\n  'jquery',\n  'chainpad',\n  'chainpad-netflux',\n  'json.sortify',\n  'xwiki-realtime-crypto',\n  'xwiki-realtime-document'\n], function(\n  /* jshint maxparams:false */\n  $, ChainPad, ChainPadNetflux, jsonSortify, Crypto, doc\n) {\n  'use strict';\n\n  function warn(...args) {\n    log('warn', ...args);\n  }\n\n  function debug(...args) {\n    log('debug', ...args);\n  }\n\n  function log(level, ...args) {\n    console[level]('[Saver] ', ...args);\n  }\n\n  // The interval between two consecutive saves (when the content is modified). Using a slightly different value for\n  // each client may help reduce the chances of conflicts.\n  const SAVE_INTERVAL = 60000 + Math.random() * 6000;\n\n  // How long to wait after broadcasting the intention to save, before actually saving the content. This helps reduce\n  // the chances of concurrent saves (which often lead to merge conflicts).\n  const SAVE_DELAY = 1000;\n\n  function now() {\n    return new Date().getTime();\n  }\n\n  /**\n   * Generic auto-saver that keeps track of local update count and schedules saves when the content is modified.\n   */\n  class GenericSaver {\n    constructor() {\n      // The state of this saver instance, that gets pushed to the other clients.\n      this._state = {\n        // The number of local changes since this saver was created. This is used to determine if there are unsaved\n        // local changes.\n        updateCount: 0,\n\n        // The number of changes for each client that were last saved by this saver.\n        savedUpdateCount: {},\n\n        // Whether there are unsaved local changes. This is deterimned by comparing the local update count with the\n        // saved updated count of all clients.\n        dirty: false,\n\n        // Whether this saver is currently saving the content. A value greater than 0 means the saver is currently\n        // attempting to save with that priority. Depending on the saver implementation, manual save may have for\n        // instance higher priority than autosave.\n        saving: 0,\n      };\n    }\n\n    /**\n     * Called each time the edited content is modified locally.\n     */\n    contentModifiedLocally() {\n      this._state.updateCount++;\n      this._updateState(true);\n      this._scheduleSave();\n    }\n\n    isDirty() {\n      return this._state.dirty;\n    }\n\n    _scheduleSave() {\n      // Cancel the previous scheduled save.\n      clearTimeout(this._saveTimer);\n      if (!this._dirtyTimestamp || now() - this._dirtyTimestamp < SAVE_INTERVAL) {\n        this._saveTimer = setTimeout(this._maybeSave.bind(this), SAVE_INTERVAL);\n      } else {\n        // Save right away because too much time has passed since the last time the content became dirty.\n        this._maybeSave();\n      }\n    }\n\n    _updateState(push, immediate) {\n      const wasDirty = this._state.dirty;\n      this._state.dirty =\n        // The content can't be dirty if there are no local changes.\n        this._state.updateCount > 0 &&\n        // Check if there is a client that has saved all our local changes.\n        !this._someState(state => state.savedUpdateCount[this._getClientId()] >= this._state.updateCount);\n      if (!wasDirty && this._state.dirty) {\n        // Remember the last time when the content became dirty in order to be able to save immediately when the save\n        // interval is reached (even if the use is still making changes).\n        this._dirtyTimestamp = now();\n      }\n      if (push) {\n        // Push the state of this saver to the other clients.\n        this._pushState(immediate);\n      }\n    }\n\n    _getClientId() {\n      // Must be implemented by subclasses.\n      return '';\n    }\n\n    _pushState(immediate) {\n      // Must be implemented by subclasses.\n    }\n\n    _maybeSave() {\n      if (!this._isSomeoneSaving() && this._isSomeoneDirty()) {\n        this._save();\n      }\n    }\n\n    _isSomeoneSaving() {\n      return this._someState(state => state.saving);\n    }\n\n    _isSomeoneDirty() {\n      return this._someState(state => state.dirty);\n    }\n\n    _someState(predicate) {\n      return Object.values(this._getStates()).some(predicate);\n    }\n\n    _getStates() {\n      // Must be implemented by subclasses.\n      return {};\n    }\n\n    async _save(options) {\n      options = options || {};\n\n      this._state.saving = this._getSavePriority(options);\n      // Let the others know immediately that we are saving, in order to reduce concurrent saves.\n      this._updateState(true, true);\n\n      const savingClientId = await this._getSavingClientId();\n      if (savingClientId === this._getClientId()) {\n        const savedUpdateCount = this._getUpdateCounts();\n        debug(\"Saving \", savedUpdateCount);\n\n        try {\n          await this._submit(options);\n          this._state.savedUpdateCount = savedUpdateCount;\n        } catch (error) {\n          warn(\"Failed to save.\", error);\n        }\n      }\n\n      this._state.saving = 0;\n      // Propagate the state immediately after a successful save because the user may leave the edit mode and this will\n      // close the WebSocket connection.\n      this._updateState(true, true);\n    }\n\n    _getSavePriority() {\n      // By default all clients have the same priority when saving. Subclasses may override this method to give higher\n      // priority to manual saves, for instance (i.e. when the user clicks on the same button).\n      return 1;\n    }\n\n    /**\n     * The autosave can be triggered on multiple clients at the same time (i.e. multiple clients can set their own\n     * saving flag before they received the saving flag from the other clients). This method is used to determine which\n     * client should save the content in this case. By default the client with the highest save priority and the lowest\n     * id (in alphabetical order) wins.\n     *\n     * @returns the id of the client that should save the content\n     */\n    _getSavingClientId() {\n      return new Promise(resolve => {\n        setTimeout(() => {\n          // Initialize with minimum save priority.\n          let savePriority = 1, savingClientId;\n          for (const [clientId, state] of Object.entries(this._getStates())) {\n            if (state.saving > savePriority || (state.saving === savePriority &&\n                (!savingClientId || savingClientId > clientId))) {\n              savePriority = state.saving;\n              savingClientId = clientId;\n            }\n          }\n          resolve(savingClientId);\n        }, SAVE_DELAY);\n      });\n    }\n\n    _getUpdateCounts() {\n      const updateCounts = {};\n      for (const [clientId, state] of Object.entries(this._getStates())) {\n        updateCounts[clientId] = state.updateCount || 0;\n      }\n      return updateCounts;\n    }\n\n    async _submit(options) {\n      // Must be implemented by subclasses.\n    }\n  }\n\n  /**\n   * Autosaver that synchronizes the states of the clients using ChainPad.\n   */\n  class ChainPadSaver extends GenericSaver {\n    constructor(config) {\n      super();\n\n      // The cached states of all the clients, grouped by editor type (because we use the same Netflux channel for all\n      // editor types).\n      this._states = {};\n\n      this._revertList = [];\n\n      this._initializing = new Promise(resolve => {\n        this._notifyReady = () => {\n          // Mark the Saver as ready right away (rather than using a promise callback which would be called on the next\n          // tick), to be visible to the code executed right after _notifyReady is called.\n          this._initializing = false;\n          resolve();\n        };\n      });\n\n      this._config = $.extend({}, config);\n      this._states[this._config.editorType] = {\n        [this._getClientId()]: this._state\n      };\n\n      this._realtimeInput = ChainPadNetflux.start(this._getRealtimeConfig());\n      this._revertList.push(() => {\n        this._realtimeInput?.stop();\n        delete this._realtimeInput;\n      });\n    }\n\n    _getClientId() {\n      return this._config.userName;\n    }\n\n    _getStates() {\n      return this._states[this._config.editorType];\n    }\n\n    _pushState(immediate) {\n      this._getStates()[this._getClientId()] = this._state;\n      this._onLocal();\n      if (immediate) {\n        this._chainpad.sync();\n      }\n    }\n\n    async toBeReady() {\n      if (this._initializing) {\n        await this._initializing;\n      }\n      return this;\n    }\n\n    _getRealtimeConfig() {\n      return {\n        initialState: '{}',\n        network: this._config.network,\n        userName: this._config.userName || '',\n        channel: this._config.channel,\n        crypto: Crypto,\n        // Operational Transformation\n        patchTransformer: ChainPad.SmartJSONTransformer,\n  \n        onRemote: this._onRemote.bind(this),\n        onReady: this._onReady.bind(this),\n        onLocal: this._onLocal.bind(this),\n        onAbort: this.stop.bind(this)\n      };\n    }\n\n    _onReady(info) {\n      this._chainpad = info.realtime;\n      this._notifyReady();\n      this._onLocal();\n    }\n\n    _onRemote() {\n      if (this._initializing) {\n        return;\n      }\n\n      const remoteStates = this._chainpad.getUserDoc();\n      debug('Received remote states: ', remoteStates);\n\n      try {\n        this._states = JSON.parse(remoteStates);\n        this._state = this._getStates()[this._getClientId()] || this._state;\n        this._updateState();\n      } catch (e) {\n        warn(\"Unable to parse remote states.\", e);\n      }\n    }\n\n    _onLocal() {\n      if (this._initializing) {\n        return;\n      }\n      const localStates = jsonSortify(this._states);\n      debug('Push local states: ', localStates);\n      this._chainpad.contentUpdate(localStates);\n      const remoteStates = this._chainpad.getUserDoc();\n      if (remoteStates !== localStates) {\n        warn(\"Unexpected remote states after synchronization: \", {\n          expected: localStates,\n          actual: remoteStates\n        });\n      }\n    }\n\n    /**\n     * Stop the autosave when the user disallows realtime or when the WebSocket is disconnected.\n     */\n    stop() {\n      // Cancel the scheduled save.\n      clearTimeout(this._saveTimer);\n\n      // Disconnect from the realtime channel and revert the changes made by this saver (i.e. remove event listeners,\n      // restore action buttons behaviour).\n      this._revertList.forEach(revert => revert());\n    }\n  }\n\n  /**\n   * A ChainPadSaver implementation specific to XWiki.\n   */\n  class XWikiSaver extends ChainPadSaver {\n    constructor(config) {\n      super($.extend({\n        formId: 'edit'\n      }, config));\n    }\n\n    _onReady(info) {\n      super._onReady(info);\n\n      // There's a very small chance that the preview button might cause problems, so let's just get rid of it.\n      $('[name=\"action_preview\"]').hide();\n      this._revertList.push(() => {\n        $('[name=\"action_preview\"]').show();\n      });\n\n      const form = document.getElementById(this._config.formId);\n      this._overwriteAjaxSaveAndContinue(form);\n\n      const beforeSaveHandler = event => {\n        if (!this._state.saving) {\n          event.preventDefault();\n          event.stopImmediatePropagation();\n          this._save({button: event.target});\n        }\n      };\n      $(form).on('xwiki:actions:beforeSave.realtime-saver', beforeSaveHandler);\n      this._revertList.push(() => {\n        $(document).off('xwiki:actions:beforeSave.realtime-saver', beforeSaveHandler);\n      });\n    }\n\n    _overwriteAjaxSaveAndContinue(form) {\n      const self = this;\n      const originalAjaxSaveAndContinue = $.extend({}, XWiki.actionButtons.AjaxSaveAndContinue.prototype);\n      const newAjaxSaveAndContinue = {\n        // Prevent the save buttons from reloading the page. Instead, reset the editor's content.\n        // FIXME: The in-place editor is also overriding reloadEditor, before this code is executed, so here we're\n        // actually overwritting in-place editor's behavior.\n        reloadEditor: () => {\n          doc.reload();\n          // TODO: Handle the page title.\n          this._config.getTextAtCurrentRevision().then(data => {\n            this._config.setTextValue(data);\n          });\n          // HACK: Replicate the behavior from the in-place editor.\n          setTimeout(() => {\n            $(form).trigger('xwiki:actions:reload');\n          }, 0);\n        },\n        // Redirect only after we have confirmation that the saver state has been propagated to all clients.\n        maybeRedirect: function(continueEditing) {\n          if (!continueEditing) {\n            self._chainpad.onSettle(() => {\n              originalAjaxSaveAndContinue.maybeRedirect.apply(this, arguments);\n            });\n            return true;\n          } else {\n            return originalAjaxSaveAndContinue.maybeRedirect.apply(this, arguments);\n          }\n        }\n      };\n      $.extend(XWiki.actionButtons.AjaxSaveAndContinue.prototype, newAjaxSaveAndContinue);\n      this._revertList.push(() => {\n        // Revert only if the method has not been overridden by another script.\n        for(const [methodName, method] of Object.entries(newAjaxSaveAndContinue)) {\n          if (XWiki.actionButtons.AjaxSaveAndContinue.prototype[methodName] === method) {\n            XWiki.actionButtons.AjaxSaveAndContinue.prototype[methodName] = originalAjaxSaveAndContinue[methodName];\n          }\n        }\n      });\n    }\n\n    _updateState(push, immediate) {\n      super._updateState(push, immediate);\n\n      let latestVersion = '0.0';\n      let savedBy;\n      for (const [clientId, state] of Object.entries(this._getStates())) {\n        if (this._compareVersions(state.version || '0.0', latestVersion) > 0) {\n          latestVersion = state.version;\n          savedBy = clientId;\n        }\n      }\n      if (this._compareVersions(latestVersion, doc.version) > 0) {\n        doc.update({\n          version: latestVersion,\n          modified: now(),\n          isNew: false\n        });\n        if (savedBy !== this._getClientId()) {\n          this._config.showNotification('savedRemote', [latestVersion, this._getUserName(savedBy)]);\n        }\n      }\n    }\n\n    _compareVersions(a, b) {\n      const [aMajor, aMinor] = (a + '').split('.').map(Number);\n      const [bMajor, bMinor] = (b + '').split('.').map(Number);\n      return aMajor - bMajor || aMinor - bMinor;\n    }\n\n    _getUserName(clientId) {\n      if (this._config.userList) {\n        return clientId.replace(/^.*-([^-]*)%2d\\d*$/, function(all, one) {\n          return decodeURIComponent(one);\n        });\n      } else {\n        return clientId;\n      }\n    }\n\n    _getSavePriority({button}) {\n      // Give higher priority to manual saves (when the user clicks on the save button). Also give higher priority to\n      // Save & View over Save & Continue. The former leaves the edit mode so we want to make sure we don't lose unsaved\n      // changes, while the latter keeps the user in the edit mode where we have autosave.\n      if (button) {\n        // Manual save\n        return button.getAttribute('name') === 'action_save' ? 3 : 2;\n      } else {\n        // Autosave\n        return super._getSavePriority();\n      }\n    }\n\n    async _submit({button}) {\n      // The merge conflict modal is already displayed (from a previous save attempt). Clicking the save button again\n      // would reopen the same modal and reset the fields the user did not submit yet. We don't want that.\n      if ($('#previewDiffModal').is(':visible')) {\n        throw new Error('Merge conflict prevents save.');\n      }\n\n      const form = document.getElementById(this._config.formId);\n      button = button || form.querySelector('[name=\"action_saveandcontinue\"]');\n      if (!$(button).is(':enabled')) {\n        throw new Error('The save button is disabled or missing.');\n      }\n\n      const submitResultPromise = this._getSubmitResult(form);\n\n      $(button).click();\n\n      this._afterSave(await submitResultPromise);\n    }\n\n    _getSubmitResult(form, removeListeners) {\n      removeListeners = removeListeners || [];\n      return new Promise((resolve, reject) => {\n        this._once(form, removeListeners, 'xwiki:document:saved.realtime-saver', (event, data) => {\n          resolve(data);\n        });\n        this._once(form, removeListeners, 'xwiki:document:saveFailed.realtime-saver', (event, data) => {\n          if (data.response.status === 409) {\n            debug('Save blocked by merge conflict');\n            // Keep the saving flag while the user deals with the merge conflict modal (i.e. we don't want the merge\n            // conflict to be handled by multiple users because this leads to more merge conflicts).\n            this._waitForMergeConflictResolution(form).then(resolve, reject);\n          } else {\n            reject('Failed to save.');\n          }\n        });\n      });\n    }\n\n    async _waitForMergeConflictResolution(form) {\n      // There are multiple events that signal the merge conflict resolution. We want to wait for which one comes first\n      // and then remove the other listeners. For this, we collect all the remove listener functions.\n      const removeListeners = [];\n      return new Promise((resolve, reject) => {\n        // Wait for the document to be saved (after the merge conflict is resolved) or for the save to fail (which is\n        // triggered also when the merge conflict modal fails to be fetched from the server).\n        this._getSubmitResult(form, removeListeners).then(resolve, reject);\n        // ... or for the editor to be reloaded, if the user decides to discard the local changes.\n        this._once(form, removeListeners, 'xwiki:actions:reload', () => {\n          reject('Discarding local changes by reloading the editor.');\n        });\n        // ... or for the merge conflict modal to be closed without resolving the conflict.\n        this._once(document, removeListeners, 'hide.bs.modal.realtime-saver', '#previewDiffModal', () => {\n          if ($('#previewDiffModal').data('action') === 'cancel') {\n            reject('Save canceled.');\n          } else {\n            // The modal was closed but not canceled so we still need to wait for a save (successful or not) or reload\n            // event. Keep the other event listeners in the group.\n            return true;\n          }\n        });\n      });\n    }\n\n    /**\n     * Do something when any of the events from a group is triggered for the first time (once).\n     *\n     * @param {Element} target the target element on which the event listener is registered\n     * @param {Array<Function>} removeListeners the list of event listeners to remove after an event from the group is\n     *   triggered\n     * @param {...any} args the arguments passed when registering the event listener\n     */\n    _once(target, removeListeners, ...args) {\n      // Wrap the original handler so that we can remove all the event listeners in the group after one of them is\n      // triggered.\n      const originalHandler = args[args.length - 1];\n      args[args.length - 1] = (...params) => {\n        const result = originalHandler(...params);\n        if (result !== true) {\n          // Cleanup.\n          removeListeners.forEach(removeListener => removeListener());\n        }\n        return result;\n      };\n      $(target).one(...args);\n      removeListeners.push(() => $(target).off(...args));\n    }\n\n    _afterSave({newVersion}) {\n      if (newVersion === '1.1') {\n        debug('Created document version 1.1');\n      } else {\n        debug(`Version bumped from ${doc.version} to ${newVersion}.`);\n      }\n      this._state.version = newVersion;\n      this._config.showNotification('saved', [newVersion]);\n    }\n  }\n\n  return XWikiSaver;\n});\n","/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\ndefine('xwiki-realtime-toolbar', [\n  'jquery',\n  'xwiki-realtime-config',\n  'xwiki-l10n!xwiki-realtime-messages'\n], function($, Config, Messages) {\n  'use strict';\n\n  function uid() {\n    return 'rt-uid-' + String(Math.random()).substring(2);\n  }\n\n  // The element that contains the user list, debug link and lag.\n  function createRealtimeToolbar($container) {\n    return $(\n      '<div class=\"rt-toolbar\">' +\n        '<div class=\"rt-toolbar-leftside\"></div>' +\n        '<div class=\"rt-toolbar-rightside\"></div>' +\n      '</div>'\n    ).attr('id', uid()).prependTo($container.first());\n  }\n\n  function createSpinner($container) {\n    return $('<div class=\"rt-spinner\"></div>').attr('id', uid()).appendTo($container)[0];\n  }\n\n  const SPINNER_DISAPPEAR_TIME = 3000;\n  const SPINNER = ['-', '\\\\', '|', '/'];\n  function kickSpinner(spinnerElement, reversed) {\n    const text = spinnerElement.textContent || '-';\n    const delta = reversed ? -1 : 1;\n    spinnerElement.textContent = SPINNER[(SPINNER.indexOf(text) + delta) % SPINNER.length];\n    clearTimeout(spinnerElement.timeout);\n    spinnerElement.timeout = setTimeout(function () {\n      spinnerElement.textContent = '';\n    }, SPINNER_DISAPPEAR_TIME);\n  }\n\n  function createUserList($container) {\n    return $('<div class=\"rt-user-list\"></div>').attr('id', uid()).appendTo($container)[0];\n  }\n\n  const userDisplayMode = Config.toolbarUserlist || 'both';\n  function getOtherUsers(myUserId, userList, usersData) {\n    return userList.map(function(userId) {\n      // Collect the user data.\n      const userData = usersData?.[userId];\n      if (userData && userId !== myUserId) {\n        const userJSON = userData.name?.replace(\n          // <userReference>-encoded(<userName>)%2d<randomNumber>\n          /^(.*)-([^-]*)%2d\\d*$/,\n          function(all, userReference, userName) {\n            return JSON.stringify({\n              reference: userReference,\n              name: decodeURIComponent(userName)\n            });\n          }\n        );\n        if (userJSON !== userData.name) {\n          return $.extend(JSON.parse(userJSON), {\n            id: userId,\n            avatar: userData.avatar\n          });\n        }\n      }\n    }).filter(function(user) {\n      // Filter out users without data.\n      return user;\n    // Display each user. We don't need to separate the users with comma if the avatars are displayed.\n    }).map(displayUser).join((userDisplayMode === 'avatar' || userDisplayMode === 'both') ? '' : ', ');\n  }\n\n  function displayUser(user) {\n    const userDisplay = $('<a></a>').attr({\n      'class': Config.marginAvatar === 1 ? 'rt-user-link' : '',\n      'href': new XWiki.Document(XWiki.Model.resolve(user.reference, XWiki.EntityType.DOCUMENT)).getURL(),\n      'data-id': user.id,\n      'data-reference': user.reference\n    });\n    if (userDisplayMode === 'name' || userDisplayMode === 'both') {\n      userDisplay.text(user.name);\n    }\n    if (userDisplayMode === 'avatar' || userDisplayMode === 'both') {\n      if (user.avatar) {\n        $('<img class=\"rt-user-avatar\"/>').attr({\n          src: user.avatar,\n          title: user.name\n        }).prependTo(userDisplay);\n      } else if (user.avatar === '') {\n        $('<span class=\"rt-user-fake-avatar\"></span>').attr('title', user.name).text(user.name.substring(0, 1))\n          .prependTo(userDisplay);\n      }\n    }\n    return userDisplay.prop('outerHTML');\n  }\n\n  function updateUserList(myUserName, listElement, userList, userData, onUserNameClick) {\n    // Update the current user id on the tool bar (used by automated functional tests).\n    listElement.closest('.rt-toolbar').dataset.userId = myUserName;\n    if (userList.indexOf(myUserName) < 0) {\n      listElement.textContent = Messages.synchronizing;\n      return;\n    }\n    if (userList.length === 1) {\n      listElement.innerHTML = Messages.editingAlone;\n    } else {\n      listElement.innerHTML = Messages.editingWith + ' ' + getOtherUsers(myUserName, userList, userData);\n    }\n    $('.rt-user-link').off('click').on('click', function(event) {\n      event.preventDefault();\n      if (typeof onUserNameClick === 'function') {\n        onUserNameClick($(this).attr('data-id'));\n      } else if ($('iframe').length) {\n        const baseHref = $('iframe')[0].contentWindow.location.href.split('#')[0] || '';\n        $('iframe')[0].contentWindow.location.href = baseHref + '#rt-user-' + $(this).attr('data-id');\n      }\n    });\n  }\n\n  function createLagElement($container) {\n    return $('<div class=\"rt-lag\"></div>').attr('id', uid()).appendTo($container)[0];\n  }\n\n  function checkLag(getLag, lagElement) {\n    if (typeof getLag === 'function') {\n      const lag = getLag();\n      // Show the lag duration as a number of seconds.\n      lagElement.textContent = Messages.lag + ' ' + (typeof lag === 'number' ? lag / 1000 : '??');\n    }\n  }\n\n  function create({$container, myUserName, realtime, getLag, userList, config}) {\n    // Save the current user id on the tool bar to be used by automated functional tests.\n    const toolbar = createRealtimeToolbar($container).attr('data-user-id', myUserName);\n    let userListElement = createUserList(toolbar.find('.rt-toolbar-leftside'));\n    const spinner = createSpinner(toolbar.find('.rt-toolbar-rightside'));\n    const lagElement = createLagElement(toolbar.find('.rt-toolbar-rightside'));\n    let userData = config.userData;\n\n    let connected = false;\n    userList.change.push(function(newUserData) {\n      const users = userList.users;\n      if (users.indexOf(myUserName) !== -1) {\n        connected = true;\n      }\n      if (!connected) {\n        return;\n      }\n      if (newUserData) {\n        // Someone has changed their name or color.\n        userData = newUserData;\n      }\n      updateUserList(myUserName, userListElement, users, userData, config.onUsernameClick);\n    });\n\n    function ks() {\n      if (connected) {\n        kickSpinner(spinner);\n      }\n    }\n\n    realtime.onPatch(ks);\n    // Try to filter out non-patch messages, doesn't have to be perfect this is just the spinner.\n    realtime.onMessage(function(msg) {\n      if (msg.indexOf(':[2,') > -1) {\n        ks();\n      }\n    });\n\n    setInterval(function() {\n      if (connected) {\n        checkLag(getLag, lagElement);\n      }\n    }, 3000);\n\n    return {\n      toolbar,\n      failed: function() {\n        connected = false;\n        userListElement.textContent = Messages.disconnected;\n        lagElement.textContent = '';\n      },\n      reconnecting: function(userId) {\n        connected = false;\n        myUserName = userId;\n        userListElement.textContent = Messages.reconnecting;\n        lagElement.textContent = '';\n      },\n      connected: function() {\n        connected = true;\n      }\n    };\n  }\n\n  return {create};\n});\n","/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\ndefine('xwiki-realtime-typingTests', function() {\n  'use strict';\n  function setRandomizedInterval(func, target, range) {\n    let timeout;\n    const again = function() {\n      timeout = setTimeout(function() {\n        again();\n        func();\n      }, target - (range / 2) + Math.random() * range);\n    };\n    again();\n    return {\n      cancel: function() {\n        clearTimeout(timeout);\n      }\n    };\n  }\n\n  function testInput(getSelection, callback) {\n    let i = 0, textInput = \" The quick red fox jumps over the lazy brown dog.\";\n\n    let interval = setRandomizedInterval(() => {\n      const selection = getSelection();\n      if (selection?.rangeCount) {\n        const range = selection.getRangeAt(0);\n        if (range.collapsed && range.startContainer.nodeType === Node.TEXT_NODE) {\n          // \"Type\" the next character from the input string.\n          const textNode = range.startContainer;\n          textNode.insertData(range.startOffset, textInput.charAt(i));\n\n          // Type again the text input when we finish it.\n          i = (i + 1) % textInput.length;\n\n          // Update the caret position.\n          range.setStart(textNode, range.startOffset + 1);\n          range.collapse();\n          selection.removeAllRanges();\n          selection.addRange(range);\n\n          // Notify about the change.\n          callback();\n        }\n      }\n    }, 200, 50);\n\n    return {\n      cancel: () => {\n        interval.cancel();\n      }\n    };\n  }\n\n  return {\n    setRandomizedInterval,\n    testInput\n  };\n});\n","/*\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n */\ndefine('xwiki-realtime-userData', [\n  'chainpad',\n  'chainpad-netflux',\n  'json.sortify'\n], function(ChainPad, ChainPadNetflux, jsonSortify) {\n  'use strict';\n\n  let userData, onChange;\n  function updateUserData(textData) {\n    try {\n      const json = JSON.parse(textData);\n      for (let key in json) {\n        userData[key] = json[key];\n      }\n      if (typeof onChange === 'function') {\n        onChange(userData);\n      }\n    } catch (error) {\n      console.error('Failed to parse user data.', {userData: textData, error});\n    }\n  }\n\n  let module = {}, online, myId;\n\n  function startInitializing() {\n    module._initializing = new Promise(resolve => {\n      module._notifyReady = () => {\n        // Mark the UserData as ready right away (rather than using a promise callback which would be called on the next\n        // tick), to be visible to the code executed right after _notifyReady is called.\n        module._initializing = false;\n        resolve();\n      };\n    });\n  }\n\n  function createConfig(network, key, configData) {\n    return {\n      initialState: '{}',\n      network,\n      userName: configData.userName,\n      channel: key,\n      crypto: configData.crypto || null,\n      // Operational Transformation\n      patchTransformer: ChainPad.SmartJSONTransformer,\n\n      onReady: function(info) {\n        module.chainpad = info.realtime;\n        module._notifyReady();\n        updateUserData(module.chainpad.getUserDoc());\n        this.onLocal();\n      },\n\n      onLocal: function() {\n        if (!module._initializing && online) {\n          const strHyperJSON = jsonSortify(userData);\n          module.chainpad.contentUpdate(strHyperJSON);\n          if (module.chainpad.getUserDoc() !== strHyperJSON) {\n            console.warn('userDoc !== strHyperJSON');\n          }\n        }\n      },\n\n      onRemote: function(info) {\n        if (!module._initializing) {\n          updateUserData(module.chainpad.getUserDoc());\n        }\n      },\n\n      onConnectionChange: function(info) {\n        if (info.state) {\n          myId = info.myId;\n          online = true;\n          module.chainpad.start();\n          startInitializing();\n        } else {\n          module.chainpad.abort();\n          online = false;\n        }\n      }\n    };\n  }\n\n  function getMyUserData(configData, cursor) {\n    const myUserData = {\n      name: configData.userName\n    };\n    if (cursor) {\n      myUserData['cursor_' + configData.editor] = cursor;\n    }\n    if (typeof configData.userAvatar === 'string') {\n      myUserData.avatar = configData.userAvatar;\n    }\n    return myUserData;\n  }\n\n  function createUserData(configData, config) {\n    let cursor, oldCursor;\n    if (configData.editor && typeof configData.getCursor === 'function') {\n      cursor = configData.getCursor;\n      oldCursor = cursor();\n    }\n\n    const userData = {};\n    userData[myId] = getMyUserData(configData, oldCursor);\n\n    let intervalId;\n    if (typeof cursor !== 'undefined') {\n      intervalId = setInterval(function() {\n        if (!online) {\n          return;\n        }\n        const newCursor = cursor();\n        if (oldCursor !== newCursor) {\n          userData[myId] = userData[myId] || getMyUserData(configData);\n          userData[myId]['cursor_' + configData.editor] = newCursor;\n          oldCursor = newCursor;\n          onChange(userData);\n          config.onLocal();\n        }\n      }, 3000);\n    }\n\n    userData.stop = function() {\n      clearInterval(intervalId);\n      module.realtimeInput?.stop();\n      delete module.realtimeInput;\n    };\n\n    return userData;\n  }\n\n  module.start = async function(network, key, configData) {\n    startInitializing();\n\n    configData = configData || {};\n    myId = configData.myId;\n    if (!myId || !configData.userName) {\n      console.error(\"myId and userName are required!\");\n      return;\n    }\n\n    online = true;\n    onChange = configData.onChange;\n\n    const config = createConfig(network, key, configData);\n    userData = createUserData(configData, config);\n\n    // We can't store the realtimeInput in the userData object because it's not serializable to JSON.\n    module.realtimeInput = ChainPadNetflux.start(config);\n\n    await module._initializing;\n\n    return userData;\n  };\n\n  return module;\n});\n"],
"names":["define","$","JSON","parse","text","e","console","error","encrypt","x","decrypt","parseKey","cryptKey","meta","realtimeConfig","channelListAPI","getByPath","path","filter","channel","stringify","getByPathPrefix","pathPrefix","length","slice","XWikiDocument","constructor","extend","document","update","reload","getJSON","restURL","timestamp","getTime","Date","then","updatedDocument","isNew","language","translations","jqXHR","status","version","modified","content","bind","data","documentReference","locale","setVersion","val","save","post","window","docsaveurl","param","form_token","xredirect","xaction","action_saveandcontinue","xeditaction","previousVersion","editingVersionDate","minorEdit","ajax","getChannels","params","url","getRestURL","XWiki","Document","Array","isArray","Promise","reject","xwikiDocument","on","event","Messages","uid","String","Math","random","substring","getAllowRealtimeCheckbox","allowed","realtimeAllowed","bool","arguments","toggle","createAllowRealtimeCheckbox","checked","allowRealtimeCheckbox","appendTo","wrapper","append","createTextNode","allowRealtime","find","prop","createMergeMessageElement","container","$merges","attr","prependTo","timeout","messageKey","args","clearTimeout","formattedMessage","get","debug","setTimeout","fadeOut","empty","show","xm","doc","webSocketURL","module","isForced","location","href","indexOf","connectionStatusNotification","widgets","Notification","inactive","getDocLock","module.getDocLock","lockedBy","querySelectorAll","force","getRTEditorURL","getEditorURL","module.getEditorURL","info","currentURL","URL","baseURL","toString","URLSearchParams","search","forEach","delete","hash","includes","allRt","state","checkSocket","field","channels","userCount","map","join","lock","RealtimeContext","network","realtimeEnabled","user","name","userReference","Model","serialize","encodeURIComponent","replace","avatarURL","advanced","instances","updateChannels","type","create","_parseChannels","keys","eventsChannel","userDataChannel","editorChannel","key","events","userdata","active","setRealtimeEnabled","wChan","bcast","cmd","realtime","updateWarning","destroy","displayReloadModal","createModalContent","buttonReload","insertAfter","displayCustomModal","displayDisableModal","callback","buttonOK","insertBefore","getEditedFields","Object","getOfflineEditedFields","fields","isOfflineEditedField","getRealtimeEditedFields","checkSessions","module.checkSessions","types","displayModal","whenReady","rt","module.displayModal","createType","existingTypes","RealtimeCreateModal","Class","ModalPopup","initialize","$super","createContent","method","showDialog","closeDialog","displayCloseButton","verticalPosition","backgroundColor","removeOnClose","setClass","trigger","message","requestASession","sessionInProgress","classesButtons","buttonsDiv","addClass","RealtimeRequestModal","primaryActionLabel","getRequestContent","autoCreate","i","interval","setInterval","buttonCreate","click","clearInterval","remove","buttonReject","getRejectContent","reason","displayRequestErrorModal","module.displayRequestErrorModal","availableRt","setAvailableRt","module.setAvailableRt","cb","createRt","createRtCalled","$saveButton","comment","previousComment","autoAcceptSave","one","off","getCompatibleEditor","availableType","compatible","unload","addEventListener","fullScreen","resize","dispatchEvent","Event","getBoxPosition","moveBox","css","observe","MutationObserver","mutations","mutation","attributeName","attributes","warningVisible","displayWarning","$after","$warning","scrollIntoView","conflictsWarning","wsErrorConflicts","realtimeContext","compatibleEditor","suggestion","html","link","conflictsWarningInfoLink","conflictsWarningInfoRt","hideWarning","editedFields","tryParse","addMessageHandler","msg","sender","onRequestMessage","request","connectionLost","sendto","offlineFields","response","getAllUsersChannel","joinAllUsers","channelInfo","connectToNetfluxWebSocket","onOpen","connect","Netflux","resolve","require","connectingBox","ready","hide","wsError","expectedDisconnect","connectionLostInfo","userList","members","beforeLaunchRealtime","wsAvailable","requestRt","leave","bootstrap","Error","editor","forbidden","prefix","ChainPad","ChainPadNetflux","jsonSortify","Crypto","warn","log","level","SAVE_INTERVAL","GenericSaver","_state","updateCount","savedUpdateCount","dirty","saving","contentModifiedLocally","_updateState","_scheduleSave","isDirty","_saveTimer","_dirtyTimestamp","_maybeSave","push","immediate","wasDirty","_someState","_getClientId","_pushState","_isSomeoneSaving","_isSomeoneDirty","_save","predicate","values","_getStates","some","options","_getSavePriority","savingClientId","_getSavingClientId","_getUpdateCounts","_submit","savePriority","clientId","entries","SAVE_DELAY","updateCounts","ChainPadSaver","config","_states","_revertList","_initializing","_notifyReady","this._notifyReady","_config","editorType","_realtimeInput","start","_getRealtimeConfig","stop","userName","_onLocal","_chainpad","sync","toBeReady","initialState","crypto","patchTransformer","SmartJSONTransformer","onRemote","_onRemote","onReady","_onReady","onLocal","onAbort","remoteStates","getUserDoc","localStates","contentUpdate","expected","actual","revert","XWikiSaver","formId","form","getElementById","_overwriteAjaxSaveAndContinue","beforeSaveHandler","preventDefault","stopImmediatePropagation","button","target","self","originalAjaxSaveAndContinue","actionButtons","AjaxSaveAndContinue","prototype","newAjaxSaveAndContinue","reloadEditor","getTextAtCurrentRevision","setTextValue","maybeRedirect","continueEditing","apply","onSettle","methodName","latestVersion","savedBy","_compareVersions","showNotification","_getUserName","a","b","aMajor","aMinor","split","Number","bMajor","bMinor","all","decodeURIComponent","getAttribute","is","querySelector","submitResultPromise","_getSubmitResult","_afterSave","removeListeners","_once","_waitForMergeConflictResolution","originalHandler","result","removeListener","newVersion","Config","createRealtimeToolbar","$container","first","createSpinner","kickSpinner","spinnerElement","reversed","delta","textContent","SPINNER","SPINNER_DISAPPEAR_TIME","createUserList","getOtherUsers","myUserId","usersData","userId","userData","userJSON","reference","id","avatar","displayUser","userDisplayMode","userDisplay","marginAvatar","getURL","EntityType","DOCUMENT","src","title","updateUserList","myUserName","listElement","onUserNameClick","closest","dataset","synchronizing","innerHTML","editingAlone","editingWith","baseHref","contentWindow","createLagElement","toolbarUserlist","getLag","ks","connected","spinner","toolbar","userListElement","lagElement","change","newUserData","users","onUsernameClick","onPatch","onMessage","lag","failed","disconnected","reconnecting","setRandomizedInterval","func","range","again","cancel","testInput","getSelection","selection","rangeCount","getRangeAt","collapsed","startContainer","nodeType","Node","TEXT_NODE","textNode","insertData","startOffset","textInput","charAt","setStart","collapse","removeAllRanges","addRange","updateUserData","textData","json","onChange","startInitializing","module._notifyReady","createConfig","configData","chainpad","online","strHyperJSON","onConnectionChange","myId","abort","getMyUserData","cursor","myUserData","userAvatar","createUserData","oldCursor","getCursor","intervalId","newCursor","userData.stop","realtimeInput","module.start"]
}
